---
title: "Final Project EDA"
author: "Ahlam Abuawad, Lizzy Gibson & Yanelli Nunez"
date: "November 14, 2017"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(janitor)
library(rvest)
library(httr)
library(stringr)
library(forcats)
library(tableone)

theme_set(theme_bw())
theme_update(legend.position = "bottom")
```

## Exploratory Data Analysis

```{r subset_data}
all_data <- read_csv("./all_data.csv")

eda_data <- all_data %>% 
  select(school_number, english_language_learners, hispanic, other_race, poverty,
         students_with_disabilities, white, asian, black, grade, mean_scale_score,
         any_lead_free_buildings, lead_percent, minority, race)

write_csv(eda_data, "./eda_data.csv")
```

## Table One

```{r}
continuous <- c("english_language_learners", 
                "poverty","students_with_disabilities", 
                "mean_scale_score", "lead_percent")

categorical <- c("any_lead_free_buildings")

biomarkers <- c("lead_percent")

table <- CreateTableOne(vars = continuous, strata = "race", data = eda_data, factorVars = categorical)
print(table, showAllLevels = TRUE, nonnormal = biomarkers)

```

## Lead and Poverty

```{r poverty}
summary(eda_data$lead_percent)
summary(eda_data$poverty)

eda_data %>% 
  ggplot(aes(y = lead_percent, x = poverty)) + geom_hex() +
  labs(x = "Percent of students in poverty", y = "Proportion of pipes with lead > 15 ppb",
       title = "Poverty status and lead exposure")
```

## Lead and Minority Status

```{r minority}
table(eda_data$minority)
table(eda_data$race)

eda_data %>%
  ggplot(aes(y = lead_percent, x = minority)) + geom_violin() +
  labs(x = "Minority status", y = "Proportion of pipes with lead > 15 ppb",
       title = "Minority status and lead exposure")

eda_data %>%
  ggplot(aes(y = lead_percent, x = race)) + geom_violin() +
  labs(x = "Race/Ethnicity", y = "Proportion of pipes with lead > 15 ppb",
       title = "Race/Ethnicity and lead exposure")
```

## Lead and Standardized Test Scores

```{r test}
summary(eda_data$lead_percent)
summary(eda_data$mean_scale_score)

eda_data %>% 
  ggplot(aes(y = mean_scale_score, x = lead_percent)) + 
  geom_hex() +
  labs(y = "Standardized test math scores", x = "Proportion of pipes with lead > 15 ppb",
       title = "Lead exposure and student math scores")
```

### Race and Standardized Test Scores

```{r test_race}
table(eda_data$race)
summary(eda_data$mean_scale_score)

eda_data %>% 
  ggplot(aes(y = mean_scale_score, x = race)) + 
  geom_violin() +
  labs(y = "Standardized test math scores", x = "Race/Ethnicity",
       title = "Race/Ethnicity exposure and student math scores")
```

### Poverty and Standardized Test Scores

```{r poverty_test}
summary(eda_data$mean_scale_score)
summary(eda_data$poverty)

eda_data %>% 
  ggplot(aes(y = mean_scale_score, x = poverty)) + geom_hex() +
  labs(x = "Percent of students in poverty", y = "Standardized test math scores",
       title = "Poverty status and student math scores")
```